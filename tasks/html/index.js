const gulp = require('gulp');
const gulpIf = require('gulp-if');
const rename = require('gulp-rename');
const fileInclude = require('gulp-file-include');
const htmlmin = require('gulp-htmlmin');

module.exports = function (config) {
  return gulp.src(config.src)
    .pipe(fileInclude({
      indent: true
    }))
    .pipe(htmlmin({
      caseSensitive: true,
      collapseBooleanAttributes: true,
      collapseWhitespace: true,
      conservativeCollapse: true,
      html5: true,
      includeAutoGeneratedTags: true,
      preventAttributesEscaping: true,
      removeAttributeQuotes: true,
      removeComments: true,
      removeEmptyAttributes: true,
      removeScriptTypeAttributes: true,
      removeStyleLinkTypeAttributes: true,
      useShortDoctype: true
    }))
    .pipe(gulpIf(config.name, rename(config.name)))
    .pipe(gulp.dest(config.dest));
};
